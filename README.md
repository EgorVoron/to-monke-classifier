# ToMonke: Классификатор видов обезьян

##  О проекте

---

###  Постановка задачи

Классификатор видов обезьян предназначен для определения вида обезьяны по фотографии.  
Количество ML-макак растет экспоненциально, и уже давно необходимо автоматизировать процесс их классификации.

---

###  Формат входных и выходных данных

- **Входные данные:** тензоры изображений (`H*W*C`)
- **Выходные данные:** вероятности классов обезьян
  (в итоговом сервисе — название класса на латинском и английском языках)

---

### Метрики

- **Accuracy**  
- **F1-score**  

---

### Валидация

- Выборка уже разделена на train и validation.

---

### Данные

- **Датасет:** [10 Monkey Species (Kaggle)](https://www.kaggle.com/datasets/slothkong/10-monkey-species/data)
- **Потенциальные проблемы:**  
  - Разные размеры изображений  
  - Разный контраст

---

### Моделирование

#### Основная модель

В качестве основной модели используется [ResNet18](https://arxiv.org/abs/1512.03385) с добавлением fc-слоя.

---

### Внедрение

- Готов mlflow-сервер

---

---

##  Технические детали

### Setup


Для начала убедитесь, что у вас установлен poetry. Может понадобиться команда `export PATH="$HOME/.local/bin:$PATH"`

_Все команды выполняются в корне репозитория_

Создание виртуального окружения и установка зависимостей:
```
poetry install
```
Далее активируйте окружение с помощью команды 
```
eval $(poetry env activate)
 ```
или добавляйте `poetry run` перед соответствующими командами.
В связи с новой политикой компании google придется установить секреты от gdrive client. Я передам нужные секреты, их надо установить как env-переменные следующей командой:
```
export GDRIVE_CLIENT_ID=XXXX
export GDRIVE_CLIENT_SECRET=YYYY
./set_gdrive_secrets.sh
```

 
### Setup
Запуск тренировки: 
```
python to_monke_classifier/train.py
```

На этом этапе скачиваются (или проверяются, что установлены) данные из DVC + происходит обучение + модель сохраняется в формате pth и onnx  
На процесс обучения можно посмотреть в mlflow на http://127.0.0.1:8080, для этого в отдельной вкладке терминала запустите
```
mlflow ui --backend-store-uri ./mlruns
```
### Production preparation
Модель после тренировки уже переведена в нужные форматы, все данные для продакшена тоже имеются.
### Infer
Для запуска сервера используйте следующую команду:
```
mlflow models serve -m ./mlartifacts/<Experiment ID>/<Run ID>/artifacts/model -p 5001 --env-manager=local
```
`Experiment ID` и `Run ID` возьмите из интерфейса mlflow.
Для отправки данных можете воспользоваться клиентом:
```
python -m to_monke_classifier.commands infer <путь до изображения в формате .png>
```

---

---

##  Экспертный комментарий
![img_1.png](readme_img.png)